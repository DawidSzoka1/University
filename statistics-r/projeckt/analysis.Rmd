---
title: "Analiza danych"
author: "Dawid Szoka"
date: "2025-04-17"
output:
   ioslides_presentation:
    widescreen: true
    smaller: true
---
## Wczytywanie danych i biblioteki
```{r}
library(tidyverse)
library(e1071)
library(DT)
data <- read.csv("fuel_sample.csv")
```
## Parametry liczbowe i pozycyjne
```{r}
opisz_liczbowa <- function(x) {
  tibble(
    typ = "numeryczna",
    mean = mean(x, na.rm = TRUE),
    sd = sd(x, na.rm = TRUE),
    min = min(x, na.rm = TRUE),
    Q1 = quantile(x, 0.25, na.rm = TRUE),
    median = median(x, na.rm = TRUE),
    Q3 = quantile(x, 0.75, na.rm = TRUE),
    max = max(x, na.rm = TRUE),
    IQR = IQR(x, na.rm = TRUE),
    skewness = skewness(x, na.rm = TRUE),
    kurtosis = kurtosis(x, na.rm = TRUE),
    moda = NA,
    n_unique = length(unique(x))
  )
}

```
## Funkcja opisująca zmienne nieliczbowe
```{r}
opisz_nieliczbowa <- function(x) {
  tab <- sort(table(x), decreasing = TRUE)
  najczestsza <- names(tab)[1]
  najrzadsza <- names(tab)[length(tab)]
  tibble(
    typ = "kategoryczna",
    mean = NA,
    sd = NA,
    min = NA,
    Q1 = NA,
    median = NA,
    Q3 = NA,
    max = NA,
    IQR = NA,
    skewness = NA,
    kurtosis = NA,
    moda = najczestsza,
    freq_moda = tab[1],
    prop_moda = round(tab[1] / sum(tab), 3),
    n_unique = length(unique(x)),
    najrzadsza = najrzadsza,
    n_NA = sum(is.na(x))
  )
}
```
## Przejście po wszystkich kolumnach
```{r}
statystyki <- map_df(names(data), function(nazwa) {
  x <- data[[nazwa]]
  if (is.numeric(x)) {
    opisz_liczbowa(x) %>% mutate(zmienna = nazwa)
  } else {
    opisz_nieliczbowa(x) %>% mutate(zmienna = nazwa)
  }
})

# Przenosimy kolumnę "zmienna" na początek
statystyki <- statystyki %>% select(zmienna, typ, everything())

```
## 
```{r}
datatable(statystyki, filter="top",
          options = list(scrollX = TRUE, scrollY = "300px"),
          caption = "Podsumowanie wszystkich zmiennych")
```
## Przedziały ufności
Sprawdzenie stosowalności
```{r}
set.seed(20250322)
values <- na.omit(data$youSaveSpend)
n <- 40
values <- sample(values, size = n)
sh <- shapiro.test(values)
```
## Wnisoek dotyczacy stosowalności przedziałów ufności

Dla zmiennej `youSaveSpend` przeprowadzono test normalności Shapiro-Wilks

- liczność próby: `r n`
- statystyka W: `r round(sh$statistic, 3)`
- wartość p: `r signif(sh$p.value, 3)`

Wartość p = `r signif(sh$p.value, 3)` jest większa niż 0.05, co oznacza, że nie ma podstaw do odrzucenia hipotezy o normalnym rozkładzie danych. Ponieważ liczność próby przekracza 30 (n = `r n`), możliwe jest stosowanie przedziału ufności dla średniej z wykorzystaniem rozkładu t-Studenta.

W związku z tym uznaje się, że przedziały ufności dla (`youSaveSpend`) są statystycznie stosowalne.

## Wyznacznie przedziałów ufności `youSaveSpend`
```{r}
# Przedział ufności dla średniej
mean_val <- mean(values)
ci_mean <- t.test(values, conf.level = 0.95)
# Przedział ufności dla mediany (bootstrap)
boot_median <- replicate(1000, median(sample(values, replace = TRUE)))
ci_median <- quantile(boot_median, c(0.025, 0.975))
# Przedział dla wariancji
s2 <- var(values)
alpha <- 0.05
ci_var <- c(
  (n - 1) * s2 / qchisq(1 - alpha/2, df = n - 1),
  (n - 1) * s2 / qchisq(alpha/2, df = n - 1)
)
# Liczymy liczbę przypadków spełniających warunek
successes <- sum(values > 0)
# Przedział ufności dla proporcji (frakcji)
ci_frac <- binom.test(successes, n, conf.level = 0.95)
```
## Wnioski
### Średnia

- Średnia z próby: `r round(mean_val, 2)`
- 95% przedział ufności: [`r round(ci_mean$conf.int[1], 2)`, `r round(ci_mean$conf.int[2], 2)`]
- Wniosek: Z 95% pewnością średnia wartość zmiennej `youSaveSpend` w populacji mieści się w podanym przedziale.

### Mediana

- Mediana z próby: `r round(median(values), 2)`
- 95% przedział ufności (bootstrap): [`r round(ci_median[1], 2)`, `r round(ci_median[2], 2)`]
- Wniosek: Mediana wartości `youSaveSpend` mieści się w przedziale wyznaczonym z wykorzystaniem metody bootstrap.

---

### Wariancja

- Wariancja z próby: `r round(s2, 2)`
- 95% przedział ufności: [`r round(ci_var[1], 2)`, `r round(ci_var[2], 2)`]
- Wniosek: Wariancja zmiennej `youSaveSpend` w populacji znajduje się w podanym zakresie. Obliczenia oparto na rozkładzie chi-kwadrat, przy założeniu normalności.

### Frakcja (youSaveSpend > 0)

- Frakcja dodatnich wartości: `r round(successes / n, 2)`
- 95% przedział ufności: [`r round(ci_frac$conf.int[1], 2)`, `r round(ci_frac$conf.int[2], 2)`]
- Wniosek: Z 95% pewnością udział przypadków z dodatnim `youSaveSpend` mieści się w tym zakresie.